---

dependency:
  name: galaxy

driver:
  name: delegated

lint: |
  yamllint .
  ansible-lint

platforms:
- name: ${MOLECULE_DISTRO}-${GITHUB_RUN_NUMBER}-001
  instance_name: ${MOLECULE_DISTRO}-${GITHUB_RUN_NUMBER}
  region: europe-west1
  network: default
  subnetwork: default
  machine_type: f1-micro
  image: ${MOLECULE_DISTRO}
  image_project: ${MOLECULE_DISTRO_PROJECT}

provisioner:
  name: ansible
  playbooks:
    converge: ${MOLECULE_PLAYBOOK:-converge.yml}
    create: ../common/create.yml
    destroy: ../common/destroy.yml
    prepare: ../common/prepare.yml
  connection_options:
    ansible_ssh_user: "github-ci"
    ansible_ssh_private_key_file: "~/.ssh/${GITHUB_WORKFLOW}_${GITHUB_RUN_NUMBER}"
    ansible_ssh_common_args: -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
  ansible_args:
    - --inventory=../common/gce_instances.gcp.yml